他山之玉：C++ 如何用别人的东西

# 0 前置知识

## 0.1 声明vs定义

声明是表示有一个东西在那儿，具体有什么功能（即实现）编译器不管。

但是你打算用一个东西的时候，程序就必须找得到它的定义，也就是实现。



## 0.2 编译vs连接

编译器在预处理器完工后，对一个编译单元进行编译到目标文件，这是编译器的事情，这个过程会找不符合语法的代码，找不到定义的代码等。

而多个目标文件合成最终的程序时，不管是可执行程序（有主函数）还是库文件，则要靠连接器完成多部分的沟通工作。



## 0.3 头文件

习惯上，声明放在头文件中，而使用 cpp 文件来定义。但不绝对，因为预处理器、编译器是不管后缀名的，只认是不是符合语法的文本文件。



# 1 源代码

有的开源代码库直接提供源代码，你可以拷贝源代码（h、hpp、c、cpp等）到你的工程下，随着预处理、编译、连接一起完成程序的构建。

有的库以“仅头文件”的形式提供源代码，仅仅需要引入头文件就可以完成编译，可见程序设计足够精巧。

但是有的库的源代码就比较复杂了，例如图形类型的库，你可以选择编译到静态库或者动态库，然后再到你的工程中引入，这就是下面的两小节的内容了。



# 2 静态库

静态库通常是一个 lib 文件（Windows 系统）。

静态库的导入需要告诉编译器库中所有代码的声明在哪里，以及这个 lib 文件在哪里。

声明在哪里通常写入头文件中，而实现（定义）则在 lib 文件中。

静态库会直接内嵌到构建结果中，构建结果不会再有 lib 文件。

告诉编译器头文件在哪后，就可以用 include 预处理语句导入了。



# 3 动态库

发生在运行时。在 Windows 上通常是 dll 文件加一个声明的头文件，以及这个头文件中的声明的 lib 文件。

在编译时，需要头文件和 lib 文件，告诉编译器有这两个东西，跑程序时就不需要了。

跑程序时，只需要可执行和 dll 即可。