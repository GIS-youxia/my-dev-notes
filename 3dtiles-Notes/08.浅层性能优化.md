# 网络性能优化

使用 gzip，最好对全部的瓦片文件以及 json 文件提前 gzip 压缩（如果硬盘空间足够）

压缩级别 6~9

推荐使用 nginx 等静态文件高性能服务器软件。

# CesiumLab 制作优化（渐深）

精模、盒子模型、白模尽量使用小场景转换器，小参数1~2MB，大参数5MB左右，大参数不要超过10MB.

# 初始镜头优化

不要加载全场景 3dTiles！

``` JS
// 不推荐这种做法！
tileset.readyPromise.then((tileset) => { 
  viewer.camera.flyTo(tileset)
})

// 推荐飞向一个瓦片尽可能少的视角
tileset.readyPromise.then((tileset) => { 
  viewer.camera.flyTo({
    destination: new Cesium.Cartesian3(-2177745.803362473, 4388735.07160963, 4070066.8635857026),
    orientation: {
      heading: 1.7660511782912742,
      pitch: -0.3025732772119021,
    }
  })
})
```

# 几何误差优化

根据经验下的几何误差得到结论：几何误差越小，消失距离越小，也就是设约5km的几何误差，那镜头得进5km才显示瓦片，超过5km就不显示，性能有提高。

也就是说，几何误差越大，镜头得越远才消失！

经验下的几何误差表明，3km的几何误差约为30：当几何误差是30时，超过3km之外的瓦片就不显示。

所以，不要设过大的几何误差。

> 几何误差的意义: 超过这个几何误差代表的距离, 瓦片不显示

# 深层性能优化

深层的性能优化必须深入到瓦片合批（cmpt嵌入多个瓦片）、减少单一瓦片gltf的drawcall、减小瓦片体积、使用高性能索引树结构、充分利用前端的wasm和webworker。



# 性能优化顺序

## 网络性能优化

gzip >= cache = webworker

## 显示性能优化

drawcall >> 瓦片合批 >> 几何误差控制 > 顶点数量压缩+纹理图片压缩(即瓦片文件大小) ≈ 树结构组织